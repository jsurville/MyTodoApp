!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@angular-component/router",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],e):e(((t=t||self)["angular-component"]=t["angular-component"]||{},t["angular-component"].router={}),t.ng.core,t.ng.common,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){return function(n,r){e(n,r,t)}}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}var d=function(){function t(){}return t.prototype.parse=function(t,e){return e?new URL(t,e):new URL(t)},t.prototype.joinUrls=function(t,e){var n=t.split("#")[0].split("?")[0].split("/");return e.split("/").reduce((function(t,e){return"."===e?t:".."===e?t.slice(0,-1):f(t,[e])}),n).join("/")},t=p([e.Injectable()],t)}(),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(r.Observable),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(r.Observable),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(r.Observable);function g(t,e){return t===e||JSON.stringify(t)===JSON.stringify(e)}var b=function(){function t(t,e,n){var i=this;this.location=t,this.platformLocation=e,this.urlParser=n,this.state$=new r.BehaviorSubject({url:this.location.path(),queryParams:{},hash:""}),this.url$=this.state$.pipe(o.map((function(t){return t.url})),o.distinctUntilChanged()),this.hash$=this.state$.pipe(o.map((function(t){return t.hash})),o.distinctUntilChanged()),this.queryParams$=this.state$.pipe(o.map((function(t){return t.queryParams})),o.distinctUntilChanged(g)),this.location.subscribe((function(){i.nextState(i.getLocation())})),this.nextState(this.getLocation())}return t.prototype.forward=function(){this.location.forward(),this.nextState(this.getLocation())},t.prototype.back=function(){this.location.back(),this.nextState(this.getLocation())},t.prototype.go=function(t,e,n){this.location.go(this.serializeUrl(t,e,n)),this.nextState(this.getLocation())},t.prototype.replace=function(t,e,n){this.location.replaceState(this.serializeUrl(t,e,n)),this.nextState(this.getLocation())},t.prototype.serializeUrl=function(t,e,n){return t.startsWith("/")||(t=this.urlParser.joinUrls(this.location.path(),t)),t+(e?"?"+this.stringifyQueryParams(e):"")+(n?"#"+n:"")},t.prototype.getExternalUrl=function(t){return this.location.prepareExternalUrl(t)},t.prototype.parseSearchParams=function(t){var e=new URLSearchParams(t),n={};return e.forEach((function(t,e){n[e]=t})),n},t.prototype.normalizePath=function(t){return this.location.normalize(t)},t.prototype.getLocation=function(){return this.platformLocation.href},t.prototype.nextState=function(t){var e=this._parseUrl(t);this.state$.next({url:e.pathname,queryParams:this.parseSearchParams(e.searchParams),hash:e.hash?e.hash.split("#")[1]:""})},t.prototype._parseUrl=function(t){return this.urlParser.parse(t)},t.prototype.stringifyQueryParams=function(t){return new URLSearchParams(t).toString()},t.ctorParameters=function(){return[{type:n.Location},{type:n.PlatformLocation},{type:d}]},t.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(n.Location),e.ɵɵinject(n.PlatformLocation),e.ɵɵinject(d))},token:t,providedIn:"root"}),t=p([e.Injectable({providedIn:"root"}),c("design:paramtypes",[n.Location,n.PlatformLocation,d])],t)}(),R=function(){function t(t){this.router=t,this.target="_self",this.hrefUpdated=new e.EventEmitter}return Object.defineProperty(t.prototype,"linkTo",{set:function(t){null!=t&&(this._href=t,this._updateHref())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParams",{set:function(t){this._query=t,this._updateHref()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fragment",{set:function(t){this._hash=t,this._updateHref()},enumerable:!0,configurable:!0}),t.prototype.onClick=function(t){this._href&&(this._comboClick(t)||"_self"!==this.target||(this.router.go(this._href,this._query,this._hash),t.preventDefault()))},t.prototype._updateHref=function(){var t=this._cleanUpHref(this._href);this.linkHref=this.router.serializeUrl(t,this._query,this._hash),this.hrefUpdated.emit(this.linkHref)},t.prototype._comboClick=function(t){return(t.which||t.button)>1||t.ctrlKey||t.metaKey||t.shiftKey},t.prototype._cleanUpHref=function(t){return void 0===t&&(t=""),t.trim().replace(/(?!^)\/+$/,"")},t.ctorParameters=function(){return[{type:b}]},p([e.Input(),c("design:type",Object)],t.prototype,"target",void 0),p([e.HostBinding("href"),c("design:type",String)],t.prototype,"linkHref",void 0),p([e.Input(),c("design:type",String),c("design:paramtypes",[String])],t.prototype,"linkTo",null),p([e.Input(),c("design:type",Object),c("design:paramtypes",[Object])],t.prototype,"queryParams",null),p([e.Input(),c("design:type",String),c("design:paramtypes",[String])],t.prototype,"fragment",null),p([e.Output(),c("design:type",e.EventEmitter)],t.prototype,"hrefUpdated",void 0),p([e.HostListener("click",["$event"]),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t.prototype,"onClick",null),t=p([e.Directive({selector:"a[linkTo]"}),c("design:paramtypes",[b])],t)}();function C(t){return null!=t}var O=function(){return function(t){return t.pipe(o.filter(C))}},P={exact:!0},S=function(){function t(t,e,n,o,i){this.element=t,this.router=e,this.renderer=n,this.defaultActiveOptions=o,this.link=i,this.activeClass="active",this._activeOptions={exact:!0},this._destroy$=new r.Subject}return t.prototype.ngAfterContentInit=function(){var t=this;this.defaultActiveOptions&&!this.activeOptions?this._activeOptions=this.defaultActiveOptions:this.activeOptions&&(this._activeOptions=this.activeOptions),this.links.changes.pipe(o.takeUntil(this._destroy$)).subscribe((function(){return t.collectLinks()})),this.collectLinks()},t.prototype.ngOnChanges=function(){this.collectLinks()},t.prototype.collectLinks=function(){var t=this;this._linksSub&&this._linksSub.unsubscribe();var e=this.links?this.links.toArray().map((function(t){return t.hrefUpdated.pipe(o.startWith(t.linkHref),o.mapTo(t.linkHref),O())})):[],n=this.link?this.link.hrefUpdated.pipe(o.startWith(this.link.linkHref),o.mapTo(this.link.linkHref),O()):r.of(""),i=f([this.router.url$.pipe(o.map((function(e){return t.router.getExternalUrl(e||"/")}))),n],e);this._linksSub=r.combineLatest(i).pipe(o.takeUntil(this._destroy$)).subscribe((function(e){var n=h(e),r=n[0],o=n[1],i=n.slice(2);t.checkActive(f(i,[o]),r)}))},t.prototype.checkActive=function(t,e){var n=this,r=t.reduce((function(t,r){var o=h(r.split("?"),1)[0];return n._activeOptions.exact?t||o===e:t||e.startsWith(o)}),!1);this.updateClasses(r)},t.prototype.updateClasses=function(t){var e=this;this.activeClass.split(" ").forEach((function(n){t?e.renderer.addClass(e.element.nativeElement,n):e.renderer.removeClass(e.element.nativeElement,n)}))},t.prototype.ngOnDestroy=function(){this._destroy$.next()},t.ctorParameters=function(){return[{type:e.ElementRef},{type:b},{type:e.Renderer2},{type:void 0,decorators:[{type:e.Optional},{type:e.Inject,args:[P]}]},{type:R,decorators:[{type:e.Optional}]}]},p([e.ContentChildren(R,{descendants:!0}),c("design:type",e.QueryList)],t.prototype,"links",void 0),p([e.Input("linkActive"),c("design:type",String)],t.prototype,"activeClass",void 0),p([e.Input(),c("design:type",Object)],t.prototype,"activeOptions",void 0),t=p([e.Directive({selector:"[linkActive]"}),u(3,e.Optional()),u(3,e.Inject(P)),u(4,e.Optional()),c("design:paramtypes",[e.ElementRef,b,e.Renderer2,Object,R])],t)}(),$=function(){function t(){}return p([e.Input(),c("design:type",Object)],t.prototype,"routeComponent",void 0),t=p([e.Directive({selector:"[routeComponent]"})],t)}();function k(t){var e=t.path.replace(/^\//,"").replace(/(?:\/$)/,"");return e?e.split("/"):[]}var j=function(t,e){var n;if(t.matcher.toString()===e.matcher.toString())return 0;for(var r=k(t),o=k(e),i=0;i<Math.max(r.length,o.length);i++){var a=_(r,o,i);if(a)return a}return null===(n=t.options.exact)||void 0===n||n?-1:1};function _(t,e,n){return t.length<=n?1:e.length<=n?-1:t[n]===e[n]?0:t[n]?e[n]?x(t[n])&&x(e[n])?0:x(t[n])?1:x(e[n])?-1:t[n].localeCompare(e[n]):-1:1}function x(t){return t.startsWith(":")}var w=function(){function t(t,e){this.router=t,this.parentRouterComponent=e,this.destroy$=new r.Subject,this.state$=new r.BehaviorSubject({activeRoute:null,routes:[]}),this.activeRoute$=this.state$.pipe(o.map((function(t){return t.activeRoute})),o.distinctUntilChanged(this.compareActiveRoutes),o.takeUntil(this.destroy$)),this.routes$=this.state$.pipe(o.map((function(t){return t.routes})),o.distinctUntilChanged(this.compareRoutes),o.takeUntil(this.destroy$)),this.basePath=""}return t.prototype.ngOnInit=function(){var t=this;r.combineLatest([this.routes$.pipe(o.debounceTime(1)),this.router.url$]).pipe(o.distinctUntilChanged(),o.tap((function(e){var n,r,o=h(e,2),i=o[0],a=o[1],s=null;try{for(var p=l(i),u=p.next();!u.done;u=p.next()){var c=u.value;if(s=t.isRouteMatch(a,c)){t.setRoute(a,c);break}}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}s||t.setActiveRoute({route:null,params:{},path:""})})),o.takeUntil(this.destroy$)).subscribe()},t.prototype.setRoute=function(t,e){this.basePath=e.path;var n=function(t,e){var n,r=null===(n=e.matcher)||void 0===n?void 0:n.exec(t);if(r){var o=k(e).filter((function(t){return t.startsWith(":")})).map((function(t){return t.slice(1)}));return{path:r[0],params:o.reduce((function(t,e,n){var o;return s(s({},t),((o={})[e]=r[n+1],o))}),{})}}}(t,e);this.setActiveRoute({route:e,params:(null==n?void 0:n.params)||{},path:(null==n?void 0:n.path)||""})},t.prototype.registerRoute=function(t){return t.matcher=t.matcher||function(t){var e,n=k(t).reduce((function(t,e){return e.startsWith(":")?t+"(?:\\/([^\\/#\\?]+?))":t+"\\/"+e}),"");return null===(e=t.options.exact)||void 0===e||e?new RegExp("^"+n+"[\\/#\\?]?$","i"):new RegExp("^"+n+(n?"(?:[\\/#\\?](?=[]|$))?(?=[\\/#\\?]|[]|$)":"(?:[\\/#\\?](?=[]|$))?"),"i")}(t),this.updateRoutes(t),t},t.prototype.setActiveRoute=function(t){this.updateState({activeRoute:t})},t.prototype.unregisterRoute=function(t){this.updateRoutes(s(s({},t),{unregister:!0}))},t.prototype.normalizePath=function(t){return this.router.normalizePath(t)},t.prototype.ngOnDestroy=function(){this.destroy$.next()},t.prototype.isRouteMatch=function(t,e){var n;return null===(n=e.matcher)||void 0===n?void 0:n.exec(t)},t.prototype.compareActiveRoutes=function(t,e){return t===e||!!t&&(t.path===e.path&&g(t.params,e.params)&&t.route.path===e.route.path&&t.route.options.exact===e.route.options.exact)},t.prototype.compareRoutes=function(t,e){return t===e||!!t&&(t.length===e.length&&t.every((function(t,n){return t===e[n]})))},t.prototype.updateState=function(t){this.state$.next(s(s({},this.state$.value),t))},t.prototype.updateRoutes=function(t){var e=this.state$.value.routes;t.unregister?this.updateState({routes:e.filter((function(e){return e.matcher!==t.matcher}))}):this.updateState({routes:e.concat(t).sort(j)})},t.ctorParameters=function(){return[{type:b},{type:t,decorators:[{type:e.SkipSelf},{type:e.Optional}]}]},t=p([e.Component({selector:"router",template:"<ng-content></ng-content>"}),u(1,e.SkipSelf()),u(1,e.Optional()),c("design:paramtypes",[b,t])],t)}();function U(t){return t.routeParams$}function L(t){return t.routePath$}var I=function(){function t(t,e,n,i,a){this.router=t,this.routerComponent=e,this.resolver=n,this.viewContainerRef=i,this.compiler=a,this.reuse=!0,this.destroy$=new r.Subject,this.state$=new r.BehaviorSubject({params:{},path:"",shouldRender:!1}),this.shouldRender$=this.state$.pipe(o.map((function(t){return t.shouldRender}))),this.routeParams$=this.state$.pipe(o.map((function(t){return t.params})),o.distinctUntilChanged(),o.takeUntil(this.destroy$)),this.routePath$=this.state$.pipe(o.map((function(t){return t.path})),o.distinctUntilChanged(),o.takeUntil(this.destroy$))}var n;return n=t,Object.defineProperty(t.prototype,"path",{get:function(){return this._path},set:function(t){this._path=this.sanitizePath(t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this,e=this.routerComponent.parentRouterComponent?this.routerComponent.parentRouterComponent.basePath+this.path:this.path;this.route=this.registerRoute(e,this.exact,this.load),this.routerComponent.activeRoute$.pipe(o.filter((function(t){return null!==t})),o.distinctUntilChanged(),o.withLatestFrom(this.shouldRender$),o.mergeMap((function(e){var n=h(e,2),o=n[0],i=n[1];return o.route===t.route?t.redirectTo?(t.router.go(t.redirectTo),r.of(null)):(t.updateState({params:o.params,path:o.path}),i?r.of(null):(t.reuse||t.clearView(),t.loadAndRender(o.route))):i?r.of(t.clearView()):r.of(null)})),o.takeUntil(this.destroy$)).subscribe()},t.prototype.ngOnDestroy=function(){this.routerComponent.unregisterRoute(this.route),this.destroy$.next()},t.prototype.registerRoute=function(t,e,n){return this.routerComponent.registerRoute({path:t,load:n,options:this.routeOptions||{exact:e}})},t.prototype.loadAndRender=function(t){var n=this;return t.load?r.from(t.load().then((function(t){if(t instanceof e.NgModuleFactory){var r=t.create(n.viewContainerRef.injector).instance.routeComponent;n.renderComponent(r)}else{if(t.ɵmod)return n.compiler.compileModuleAsync(t).then((function(t){var e=t.create(n.viewContainerRef.injector).instance.routeComponent;return n.renderComponent(e),!0}));n.renderComponent(t)}return!0}))):(this.showTemplate(),r.of(!0))},t.prototype.renderComponent=function(t){var e=this.resolver.resolveComponentFactory(t);this.showTemplate(),this.viewContainerRef.createComponent(e,this.viewContainerRef.length,this.viewContainerRef.injector)},t.prototype.clearComponent=function(){this.viewContainerRef.clear(),this.hideTemplate()},t.prototype.showTemplate=function(){var t=this;setTimeout((function(){t.updateState({shouldRender:!0})}))},t.prototype.hideTemplate=function(){this.updateState({shouldRender:!1})},t.prototype.clearView=function(){this.load?this.clearComponent():this.hideTemplate()},t.prototype.sanitizePath=function(t){var e=t.trim();return e.startsWith("/")?e:"/"+e},t.prototype.updateState=function(t){this.state$.next(s(s({},this.state$.value),t))},t.ctorParameters=function(){return[{type:b},{type:w},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:e.Compiler}]},p([e.ContentChild(e.TemplateRef),c("design:type",e.TemplateRef)],t.prototype,"template",void 0),p([e.Input(),c("design:type",String),c("design:paramtypes",[String])],t.prototype,"path",null),p([e.Input(),c("design:type",e.Type)],t.prototype,"component",void 0),p([e.Input(),c("design:type",Function)],t.prototype,"load",void 0),p([e.Input(),c("design:type",Object)],t.prototype,"reuse",void 0),p([e.Input(),c("design:type",String)],t.prototype,"redirectTo",void 0),p([e.Input(),c("design:type",Boolean)],t.prototype,"exact",void 0),p([e.Input(),c("design:type",Object)],t.prototype,"routeOptions",void 0),t=n=p([e.Component({selector:"route",template:'\n    <ng-container\n      *ngIf="(shouldRender$ | async) && template"\n      [ngTemplateOutlet]="template"\n    >\n    </ng-container>\n  ',changeDetection:e.ChangeDetectionStrategy.OnPush,providers:[{provide:m,useFactory:U,deps:[[new e.Self,n]]},{provide:y,useFactory:L,deps:[[new e.Self,n]]}]}),c("design:paramtypes",[b,w,e.ComponentFactoryResolver,e.ViewContainerRef,e.Compiler])],t)}(),T=[w,I,S,R,$];function A(t){return t.queryParams$}var E=function(){function t(){}var r;return r=t,t.forRoot=function(){return{ngModule:r,providers:[d,{provide:n.LocationStrategy,useClass:n.PathLocationStrategy},{provide:v,deps:[b],useFactory:A}]}},t=r=p([e.NgModule({imports:[n.CommonModule],declarations:[T],exports:[T]})],t)}();t.ComponentRouterModule=E,t.LINK_ACTIVE_OPTIONS=P,t.LinkActive=S,t.LinkTo=R,t.QueryParams=v,t.RouteComponent=I,t.RouteComponentTemplate=$,t.RouteParams=m,t.RoutePath=y,t.Router=b,t.RouterComponent=w,t.UrlParser=d,t.compareParams=g,t.components=T,t.getQueryParams=A,t.getRouteParams=U,t.getRoutePath=L,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-component-router.umd.min.js.map